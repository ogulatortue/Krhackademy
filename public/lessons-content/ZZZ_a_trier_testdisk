<section class="content-block">
    <h2><i class="fas fa-hdd" aria-hidden="true"></i> Comment fonctionne la suppression de fichiers ?</h2>
    <p>
        Contrairement à ce que l'on pourrait penser, lorsque vous "supprimez" un fichier de votre disque dur ou de votre clé USB, les données ne sont pas immédiatement effacées. Le système d'exploitation se contente de supprimer le <strong>pointeur</strong> vers ce fichier dans sa table d'allocation (la "table des matières" du disque).
    </p>
    <p>
        Les données réelles (les 0 et les 1 qui composent votre photo `vacances.png`) restent physiquement présentes sur le support de stockage. L'espace qu'elles occupent est simplement marqué comme "disponible". Ce n'est que lorsqu'un nouveau fichier sera écrit par-dessus cet emplacement que les anciennes données seront définitivement perdues. C'est ce principe qui rend la récupération de données possible.
    </p>
</section>

<section class="content-block">
    <h2><i class="fas fa-tools" aria-hidden="true"></i> TestDisk & PhotoRec : Deux Outils, Un Objectif</h2>
    <p>
        <strong>TestDisk</strong> et <strong>PhotoRec</strong> sont deux logiciels libres et open-source, souvent distribués ensemble, qui excellent dans la récupération de données. Bien qu'ils soient complémentaires, ils ont des rôles bien distincts.
    </p>
    <ul>
        <li>
            <strong>TestDisk :</strong> C'est un expert de la <strong>structure</strong> des disques. Son rôle principal est de réparer les tables de partition corrompues, de récupérer des partitions perdues et de rendre à nouveau amorçables des disques qui ne le sont plus. Il est à utiliser lorsque le disque lui-même n'est plus reconnu correctement par le système.
        </li>
        <li>
            <strong>PhotoRec :</strong> C'est un spécialiste du "file carving" (récupération de fichiers par signature). Il ignore complètement la structure du disque (la table des partitions, les noms de fichiers) et parcourt le support de stockage secteur par secteur à la recherche de signatures de fichiers connues (les quelques octets qui marquent le début d'un fichier JPG, PDF, ZIP, etc.). Il est incroyablement efficace pour récupérer des fichiers individuels, même sur un support formaté ou sévèrement endommagé.
        </li>
    </ul>
</section>

<section class="content-block">
    <h2><i class="fas fa-user-shield" aria-hidden="true"></i> Cas d'Utilisation : Défense et Attaque</h2>
    <h3>Côté Défense (Utilisation légitime)</h3>
    <p>
        Ces outils sont des sauveurs dans de nombreuses situations :
    </p>
    <ul>
        <li>Récupération de photos de vacances supprimées par erreur d'une carte SD.</li>
        <li>Restauration de documents importants depuis un disque dur externe devenu illisible.</li>
        <li>Réparation d'une clé USB corrompue après un retrait incorrect.</li>
    </ul>
    <h3>Côté Attaque (Analyse Forensique)</h3>
    <p>
        Dans un contexte d'analyse forensique ou de pentesting, ces outils peuvent révéler des informations sensibles sur des supports récupérés :
    </p>
    <ul>
        <li>Récupération de mots de passe, de clés privées ou de documents confidentiels sur une clé USB d'entreprise "perdue".</li>
        <li>Analyse d'un disque dur pour trouver des preuves d'activités malveillantes, même si les fichiers ont été supprimés.</li>
        <li>Les informations récupérées peuvent servir à mener des attaques plus ciblées, comme du spear-phishing ou du chantage.</li>
    </ul>
</section>

<section class="content-block">
    <h2><i class="fas fa-eraser" aria-hidden="true"></i> Comment se protéger contre la récupération ?</h2>
    <p>
        Si vous souhaitez vous débarrasser d'un support de stockage contenant des données sensibles, une simple suppression ou un formatage rapide ne suffit pas.
    </p>
    <ul>
        <li><strong>Formatage complet :</strong> Contrairement au formatage rapide qui ne fait que réinitialiser la table des partitions, un formatage complet (ou de bas niveau) écrit des zéros sur l'intégralité du disque, rendant la récupération par des outils comme PhotoRec beaucoup plus difficile, voire impossible.</li>
        <li><strong>Logiciels de destruction sécurisée :</strong> Des outils comme `shred` ou `dd` sous Linux, ou DBAN (Darik's Boot and Nuke), permettent d'écrire des données aléatoires plusieurs fois sur tout le disque, conformément à des standards militaires.</li>
        <li><strong>Destruction physique :</strong> Pour les données extrêmement sensibles, la seule méthode infaillible reste la destruction physique du support (perçage, broyage, etc.).</li>
    </ul>
</section>

<section class="content-block">
    <h2><i class="fas fa-laptop-code" aria-hidden="true"></i> Exercice Pratique : Récupérer des photos supprimées</h2>
    <p>
        <strong>Objectif :</strong> Simuler la suppression accidentelle de photos sur une clé USB et les récupérer en utilisant <strong>PhotoRec</strong>. Pour des raisons de sécurité, nous travaillerons sur une copie (une image disque) de la clé USB, et non sur le périphérique réel.
    </p>
    <details>
        <summary style="cursor: pointer;">Exercice sur Linux</summary><br>
        <div class="solution-content">
            <p><strong>Prérequis :</strong> Une clé USB (au moins 1 Go), et un système Linux (ou une VM).</p>
            <ol>
                <li><strong>Préparer la clé USB :</strong> Formatez votre clé USB (en FAT32 par exemple) et copiez-y quelques images. Ensuite, supprimez-les "définitivement" (en vidant la corbeille si nécessaire).</li>
                <br><li><strong>Identifier et créer une image de la clé :</strong> Branchez la clé à votre machine. Identifiez son nom de périphérique avec la commande `lsblk`. Il s'agira probablement de quelque chose comme `/dev/sdb` ou `/dev/sdc`. <strong>Soyez très prudent de ne pas vous tromper de disque !</strong></li>
            </ol>
            <pre style="background-color:#000; border-radius:5px; padding:10px; font-family:monospace;"><code># Remplacez /dev/sdX par le nom de votre clé USB
sudo dd if=/dev/sdX of=cle_usb.img status=progress</code></pre>
            <p>Cette commande crée un fichier `cle_usb.img` qui est une copie exacte de votre clé.</p>
            <ol start="3">
                <li><strong>Installer TestDisk/PhotoRec :</strong></li>
            </ol>
            <pre style="background-color:#000; border-radius:5px; padding:10px; font-family:monospace;"><code>sudo apt update && sudo apt install testdisk</code></pre>
            <br><ol start="4">
                <li><strong>Lancer PhotoRec sur l'image disque :</strong></li>
            </ol>
            <pre style="background-color:#000; border-radius:5px; padding:10px; font-family:monospace;"><code>sudo photorec cle_usb.img</code></pre>
            <br><ol start="5">
                <li><strong>Suivre l'assistant PhotoRec :</strong>
                    <ul>
                        <li>L'image `cle_usb.img` est déjà sélectionnée, appuyez sur [Proceed].</li>
                        <li>Sélectionnez la partition (il ne devrait y en avoir qu'une) et appuyez sur [Search].</li>
                        <li>Choisissez le type de système de fichiers (probablement [Other] pour FAT/NTFS/EXT).</li>
                        <li>Choisissez où sauvegarder les fichiers récupérés. <strong>Important :</strong> choisissez un emplacement sur votre disque dur principal, PAS sur l'image de la clé.</li>
                        <li>L'analyse commence. PhotoRec va créer un ou plusieurs dossiers `recup_dir.X` et y placera tous les fichiers qu'il parvient à récupérer.</li>
                    </ul>
                </li>
            </ol>
            <p>Explorez les dossiers de récupération : vous devriez y retrouver vos photos supprimées !</p>
        </div>
    </details>
<br>
<details>
        <summary style="cursor: pointer;">Exercice version Windows</summary><br>
        <div class="solution-content">
            <p><strong>Prérequis :</strong> Une clé USB (au moins 1 Go).</p>
            <ul>
                <li><strong>Préparer la clé USB :</strong> Formatez votre clé USB et copiez-y quelques images. Ensuite, supprimez-les "définitivement" (en vidant la corbeille).</li>
                <li><strong>Télécharger TestDisk/PhotoRec :</strong> Allez sur le site officiel de CGSecurity et téléchargez la version Windows de TestDisk. Extrayez l'archive ZIP dans un dossier.</li>
                <li><strong>Lancer PhotoRec :</strong> Dans le dossier extrait, exécutez `qphotorec_win.exe` (la version avec interface graphique, plus simple).</li>
                <li><strong>Suivre l'assistant PhotoRec :</strong>
                    <ul>
                        <li>Dans le menu déroulant, sélectionnez le disque correspondant à votre clé USB.</li>
                        <li>Sélectionnez la partition principale (généralement "Whole disk").</li>
                        <li>Choisissez le type de système de fichiers.</li>
                        <li>Cliquez sur "Browse" pour choisir un dossier sur votre disque dur principal où sauvegarder les fichiers récupérés.</li>
                        <li>Cliquez sur "Search" pour lancer l'analyse.</li>
                    </ul>
                </li>
            </ul>
            <p>Une fois l'opération terminée, vérifiez le dossier de destination pour retrouver vos fichiers.</p>
        </div>
    </details>
</section>

<section class="content-block">
    <h2><i class="fas fa-info-circle" aria-hidden="true"></i>Informations sur le document original</h2>
    <p>
        <b>Titre :</b> Format 15 minutes: Récupération de données<br>
        <b>Auteur :</b> Robbie<br>
        <b>Date de publication :</b> 07/05/2025
    </p>
</section>

<nav class="content-navigation">
    <a href="./lessons.php" class="nav-button prev-button"><i class="fas fa-arrow-left" aria-hidden="true"></i> Retour aux leçons</a>
    <a href="./lessons.php" class="nav-button next-button">Valider la leçon <i class="fas fa-arrow-right" aria-hidden="true"></i></a>
</nav>
