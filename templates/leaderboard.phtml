<?php
$pageTitle = 'Classement - Kr[HACK]ademy';
$specific_css = ['/css/menus.css'];
?>
<!DOCTYPE html>
<html lang="fr">
<?php require __DIR__ . '/partials/head.phtml';?>
<body class="page-leaderboard">
    <a id="go-back-button" href="/" class="btn-glass back-button">
        <i class="fas fa-arrow-left"></i> Retour
    </a>
    <main class="container">
        <div class="content-container">
            <div class="content-wrapper menu">
                <header class="content-header">
                    <i class="fas fa-trophy content-icon"></i>
                    <div class="content-title-group">
                        <h1>Classement général</h1>
                        <p class="content-intro">Tableau d'honneur de la Kr[HACK]ademy</p>
                    </div>
                </header>
                <div class="content-block">
                    <div class="block">
                        <?php 
                            $leaderboardData = isset($leaderboardData) ? $leaderboardData : [];
                            $currentUserId = isset($currentUserId) ? $currentUserId : null;
                            $podiumUsers = array_slice($leaderboardData, 0, 3);
                            $otherUsers = array_slice($leaderboardData, 3);
                        ?>

                        <div class="podium-container">
                            <?php 
                            $podiumOrder = [1, 0, 2];
                            ?>

                            <?php foreach ($podiumOrder as $index): ?>
                                <?php if (isset($podiumUsers[$index])): 
                                    $user = $podiumUsers[$index];
                                    $rank = $index + 1;
                                    $isCurrentUser = ($user['id'] == $currentUserId);
                                ?>
                                    <div class="podium-card podium-card--<?php echo $rank; ?> <?php echo $isCurrentUser ? 'podium-card--current-user' : ''; ?>">
                                        <div class="podium-content">
                                            
                                            <?php if ($rank == 1): ?>
                                                <i class="podium-crown fas fa-crown"></i>
                                            <?php endif; ?>

                                            <a href="/profile?id=<?php echo htmlspecialchars($user['id']); ?>">
                                                <img src="<?php echo htmlspecialchars($user['avatar_url'] ?? 'images/avatars/default-avatar.webp'); ?>" alt="Avatar de <?php echo htmlspecialchars($user['username']); ?>" class="podium-avatar" style="background-color: <?= htmlspecialchars($user['avatar_bg_color'] ?? '#2b2b2d') ?>">
                                            </a>
                                            
                                            <div class="podium-user">
                                                <a href="/profile?id=<?php echo htmlspecialchars($user['id']); ?>" class="user-profile-link">
                                                    <?php echo htmlspecialchars($user['username']); ?>
                                                </a>
                                            </div>
                                            <div class="podium-score"><?php echo $user['score']; ?> <i class="fas fa-flag podium-score"></i></div>
                                            
                                            <div class="podium-rank-badge">
                                                <span><?php echo $rank; ?></span>
                                            </div>
                                        </div>
                                    </div>
                                <?php endif; ?>
                            <?php endforeach; ?>
                        </div>
                    </div>
                </div>

                <div class="content-block">
                    <div class="block">
                        <div class="leaderboard-table">
                            <div class="leaderboard-header">
                                <span class="leaderboard-cell">Rang</span>
                                <span class="leaderboard-cell"></span>
                                <span class="leaderboard-cell">Pseudo</span>
                                <span class="leaderboard-cell">Score</span>
                            </div>

                            <?php foreach ($otherUsers as $index => $user): ?>
                                <?php
                                    $rank = $index + 4;
                                    $isCurrentUser = ($user['id'] == $currentUserId);
                                ?>
                                <div class="leaderboard-row <?php echo $isCurrentUser ? 'leaderboard-row--current-user' : ''; ?>">
                                    <span class="leaderboard-cell leaderboard-cell--rank">#<?php echo $rank; ?></span>
                                    <span class="leaderboard-cell leaderboard-cell--avatar">
                                        <a href="/profile?id=<?php echo htmlspecialchars($user['id']); ?>">
                                            <img src="<?php echo htmlspecialchars($user['avatar_url'] ?? 'images/avatars/default-avatar.webp'); ?>" alt="Avatar de <?php echo htmlspecialchars($user['username']); ?>" class="leaderboard-avatar-small" style="background-color: <?= htmlspecialchars($user['avatar_bg_color'] ?? '#2b2b2d') ?>">
                                        </a>
                                    </span>
                                    <span class="leaderboard-cell leaderboard-cell--user">
                                        <a href="/profile?id=<?php echo htmlspecialchars($user['id']); ?>" class="user-profile-link">
                                            <?php echo htmlspecialchars($user['username']); ?>
                                        </a>
                                    </span>
                                    <span class="leaderboard-cell leaderboard-cell--score"><?php echo $user['score']; ?> <i class="fas fa-flag leaderboard-cell--score"></i></span>
                                </div>
                            <?php endforeach; ?>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <?php require __DIR__ . '/partials/modal.phtml';?>

</body>
</html>