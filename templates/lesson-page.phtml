<?php
$pageTitle = htmlspecialchars($lesson['title']) . ' - Kr[HACK]ademy';
$specific_css = ['/css/content-page.css'];
?>
<!DOCTYPE html>
<html lang="fr">
<?php require __DIR__ . '/partials/head.phtml'; ?>
<body class="page-lesson">
    <a href="/lessons" class="btn-glass back-button"><i class="fas fa-arrow-left"></i> Retour aux leçons</a>
    <main class="content-container">
        <div class="content-wrapper">
            <?php
            $item = $lesson;
            $type = 'lesson';
            require __DIR__ . '/partials/content-page-header.phtml';
            $filename = basename($lesson['lesson_id_str']) . '.html';
            if (strpos($filename, '/') !== false || strpos($filename, '\\') !== false) {
                echo '<section class="content-block"><p>Erreur: Chemin de fichier invalide.</p></section>';
            } else {
                $lessonContentPath = ROOT_PATH . '/public/lessons-content/' . $filename;
                if (file_exists($lessonContentPath)) {
                    include($lessonContentPath);
                } else {
                    echo '<section class="content-block"><p>Le contenu de cette leçon est actuellement indisponible.</p></section>';
                }
            }
            ?>
            <nav class="content-navigation">
            <?php if (!empty($lesson['is_completed'])): ?>
                <span class="btn-glass validated">Leçon validée <i class="fas fa-check"></i></span>
                <form class="invalidation-form" style="margin: 0;">
                    <input type="hidden" name="lesson_id" value="<?= htmlspecialchars($lesson['id']) ?>">
                    <button type="submit" class="btn-glass" title="Recommencer la leçon"><i class="fas fa-arrow-rotate-left"></i></button>
                </form>
            <?php else: ?>
                <form class="completion-form">
                    <input type="hidden" name="lesson_id" value="<?= htmlspecialchars($lesson['id']) ?>">
                    <button type="submit" class="btn-glass">Valider la leçon <i class="fas fa-arrow-right"></i></button>
                </form>
            <?php endif; ?>
            </nav>
        </div>
    </main>
    <script src="/js/completion-handler.js" defer></script>
    <?php require __DIR__ . '/partials/modal.phtml';?>
</body>
</html>