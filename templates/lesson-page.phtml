<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title><?= htmlspecialchars($lesson['title']) ?> - Kr[HACK]ademy</title>
    
    <link rel="stylesheet" href="/css/style.css"/>
    <link rel="stylesheet" href="/css/content-page.css"/>

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css"/>
    <link rel="icon" type="image/png" href="/images/logo_krhacken_r.ico" />
</head>
<body class="page-lesson">

    <a href="/lessons" onclick="history.back(); return false;" class="btn-glass back-button">
        <i class="fas fa-arrow-left" aria-hidden="true"></i> Retour aux leçons
    </a>

    <?php
    $difficulty_class = '';
    switch (strtolower($lesson['difficulty'])) {
        case 'débutant': $difficulty_class = 'difficulty-easy'; break;
        case 'initié': $difficulty_class = 'difficulty-medium'; break;
        case 'avancé': $difficulty_class = 'difficulty-hard'; break;
        case 'expert': $difficulty_class = 'difficulty-expert'; break;
    }
    ?>

    <main class="content-container">
        <div class="content-wrapper">
            <header class="content-header">
                <i class="content-icon fas <?= htmlspecialchars($lesson['icon_class'] ?? 'fa-book-open') ?>"></i>
                <div class="content-title-group">
                    <h1><?= htmlspecialchars($lesson['title']) ?></h1>
                    <p class="content-intro"><?= htmlspecialchars($lesson['description']) ?></p>
                </div>
                <span class="difficulty-tag <?= $difficulty_class ?>">
                    <?= htmlspecialchars($lesson['difficulty']) ?>
                </span>
            </header>

            <?php
            $filename = basename($lesson['lesson_id_str']) . '.html';
            $lessonContentPath = ROOT_PATH . '/public/lessons-content/' . $filename;

            if (file_exists($lessonContentPath)) {
                include($lessonContentPath);
            } else {
                echo '<section class="content-block"><p>Le contenu de cette leçon est actuellement indisponible.</p></section>';
            }
            ?>
            
            <nav class="content-navigation">
                <?php if (!empty($lesson['is_completed'])): ?>
                    <span class="btn-glass validated">Leçon validée <i class="fas fa-check"></i></span>
                    <form class="invalidation-form" style="margin: 0;">
                        <input type="hidden" name="lesson_id" value="<?= htmlspecialchars($lesson['id']) ?>">
                        <button type="submit" class="btn-glass" title="Recommencer la leçon">
                            <i class="fas fa-arrow-rotate-left"></i>
                        </button>
                    </form>
                <?php else: ?>
                    <form class="completion-form">
                        <input type="hidden" name="lesson_id" value="<?= htmlspecialchars($lesson['id']) ?>">
                        <button type="submit" class="btn-glass">
                            Valider la leçon <i class="fas fa-arrow-right" aria-hidden="true"></i>
                        </button>
                    </form>
                <?php endif; ?>
            </nav>

        </div>
    </main>

    <script src="/js/lesson-page.js" defer></script>

    <?php require __DIR__ . '/partials/modal.phtml';?>
</body>
</html>