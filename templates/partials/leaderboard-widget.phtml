<section class="widget-panel leaderboard-panel" id="leaderboard-menu" aria-hidden="true">
    <div class="leaderboard-header">
        <i class="fas fa-trophy panel-icon"></i>
        <span>Classement</span>
        <button id="close-leaderboard-btn" class="fas fa-times" aria-label="Fermer le classement"></button>
    </div>
    <div class="leaderboard-content">
        <ul class="leaderboard-list">
            <?php foreach ($leaderboardWidgetData['topUsers'] as $index => $user): ?>
                <?php
                    $podiumClass = 'podium-' . ($index + 1);
                    $isCurrentUser = ($_SESSION['user_id'] ?? null) == $user['id'];
                    $highlightClass = $isCurrentUser ? ' current-user-podium-border' : '';
                    $avatar_bg_color = $user['avatar_bg_color'] ?? '#2b2b2d';
                ?>
                <li class="leaderboard-item <?= $podiumClass . $highlightClass ?>">
                    <span class="rank">#<?= $index + 1 ?></span>
                    <a href="/profile?id=<?= htmlspecialchars($user['id']) ?>">
                        <img src="<?= htmlspecialchars($user['avatar_url'] ?? '/images/avatars/default-avatar.webp') ?>" alt="Avatar" class="leaderboard-avatar" style="background-color: <?= htmlspecialchars($avatar_bg_color) ?>">
                    </a>
                    <span class="username">
                        <a href="/profile?id=<?= htmlspecialchars($user['id']) ?>" class="user-profile-link">
                            <?= htmlspecialchars($user['username']) ?>
                        </a>
                    </span>
                    <span class="score"><?= $user['score'] ?> <i class="fas fa-flag"></i></span>
                </li>
            <?php endforeach; ?>
            <?php if ($leaderboardWidgetData['currentUser'] && !$leaderboardWidgetData['isCurrentUserInTop3']): ?>
                <?php $currentUser = $leaderboardWidgetData['currentUser']; ?>
                <li class="leaderboard-separator"></li>
                <li class="leaderboard-item current-user">
                    <span class="rank">#<?= $currentUser['rank'] ?></span>
                    <a href="/profile?id=<?= htmlspecialchars($currentUser['id']) ?>">
                        <img src="<?= htmlspecialchars($currentUser['avatar_url'] ?? '/images/avatars/default-avatar.webp') ?>" alt="Votre avatar" class="leaderboard-avatar" style="background-color:<?= htmlspecialchars($currentUser['avatar_bg_color'] ?? '#2b2b2d') ?>" >
                    </a>
                    <span class="username">
                        <a href="/profile?id=<?= htmlspecialchars($currentUser['id']) ?>" class="user-profile-link">
                            <?= htmlspecialchars($currentUser['username']) ?>
                        </a>
                    </span>
                    <span class="score"><?= $currentUser['score'] ?> <i class="fas fa-flag"></i></span>
                </li>
            <?php endif; ?>
        </ul>
    </div>
    <ul class="leaderboard-options">
        <li><a href="/leaderboard"><i class="fas fa-arrow-right"></i> Classement complet</a></li>
    </ul>
</section>