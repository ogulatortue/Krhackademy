<?php
$pageTitle = 'Paramètres - Kr[HACK]ademy';
$specific_css = ['/css/menus.css'];
?>
<!DOCTYPE html>
<html lang="fr">
<?php require __DIR__ . '/partials/head.phtml';?>
<body class="page-settings">
    <a id="go-back-button" href="/" class="btn-glass back-button">
        <i class="fas fa-arrow-left"></i> Retour
    </a>
    <main class="container">
        <div class="content-container">
            <div class="content-wrapper menu">
                <header class="content-header">
                    <i class="fas fa-cog content-icon"></i>
                    <div class="content-title-group">
                        <h1>Paramètres</h1>
                        <p class="content-intro">Gérez votre compte, votre sécurité et vos préférences</p>
                    </div>
                </header>

                <?php if (!empty($success)): ?>
                    <div class="alert alert-success"><?php echo $success; ?></div>
                <?php endif; ?>
                <?php if (!empty($errors)): ?>
                    <div class="alert alert-danger">
                        <?php foreach ($errors as $error): ?>
                            <p><?php echo $error; ?></p>
                        <?php endforeach; ?>
                    </div>
                <?php endif; ?>

                <div class="content-block">
                    <div class="settings-section">
                        <h2>Gestion du Compte</h2>
                        <form action="/settings" method="POST">
                            <input type="hidden" name="csrf_token" value="<?php echo csrf_token(); ?>">
                            <input type="hidden" name="action" value="update_account">
                            <div class="form-group">
                                <label for="username">Pseudo</label>
                                <input type="text" id="username" name="username" class="form-control" value="<?php echo htmlspecialchars($currentUser['username']); ?>">
                            </div>
                            <div class="form-group">
                                <label for="email">Adresse e-mail</label>
                                <input type="email" id="email" name="email" class="form-control" value="<?php echo htmlspecialchars($currentUser['email']); ?>">
                            </div>
                            <button type="submit" class="btn-primary">Mettre à jour</button>
                        </form>
                    </div>
                </div>

                <div class="content-block">
                    <div class="settings-section">
                        <h2>Sécurité</h2>
                        <form action="/settings" method="POST">
                            <input type="hidden" name="csrf_token" value="<?php echo csrf_token(); ?>">
                            <input type="hidden" name="action" value="change_password">
                            <div class="form-group">
                                <label for="current_password">Mot de passe actuel</label>
                                <input type="password" id="current_password" name="current_password" class="form-control" required>
                            </div>
                            <div class="form-group">
                                <label for="new_password">Nouveau mot de passe</label>
                                <input type="password" id="new_password" name="new_password" class="form-control" required>
                            </div>
                            <div class="form-group">
                                <label for="confirm_password">Confirmer le nouveau mot de passe</label>
                                <input type="password" id="confirm_password" name="confirm_password" class="form-control" required>
                            </div>
                            <button type="submit" class="btn-primary">Changer le mot de passe</button>
                        </form>
                    </div>
                </div>

                <div class="content-block">
                    <div class="settings-section">
                        <h2>Personnalisation du Profil</h2>
                        <form action="/settings" method="POST" enctype="multipart/form-data">
                            <input type="hidden" name="csrf_token" value="<?php echo csrf_token(); ?>">
                            <input type="hidden" name="action" value="update_profile">

                            <div class="form-group">
                                <label for="bio">Biographie</label>
                                <textarea id="bio" name="bio" class="form-control" rows="3"><?php echo htmlspecialchars($currentUser['bio'] ?? ''); ?></textarea>
                            </div>

                            <div class="form-group">
                                <label for="avatar_image">Avatar (JPG, PNG, GIF - Max 2Mo)</label>
                                <input type="file" id="avatar_image" name="avatar_image" class="form-control">
                            </div>

                            <div class="form-group">
                                <label for="banner_image">Bannière de profil (JPG, PNG, GIF - Max 2Mo)</label>
                                <input type="file" id="banner_image" name="banner_image" class="form-control">
                            </div>

                            <button type="submit" class="btn-primary">Mettre à jour le profil</button>
                        </form>
                    </div>
                </div>

                <div class="content-block">
                    <div class="settings-section danger-zone">
                        <h2>Zone de Danger</h2>
                        <p>Cette action est irréversible. Toutes vos données seront définitivement supprimées.</p>
                        <form action="/settings" method="POST" onsubmit="return confirm('Êtes-vous absolument certain de vouloir supprimer votre compte ? Cette action est irréversible.');">
                            <input type="hidden" name="csrf_token" value="<?php echo csrf_token(); ?>">
                            <input type="hidden" name="action" value="delete_account">
                            <button type="submit" class="btn-primary btn-danger">Supprimer mon compte</button>
                        </form>
                    </div>
                </div>

            </div>
        </div>
    </main>
</body>
</html>